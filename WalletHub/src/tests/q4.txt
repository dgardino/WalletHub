-- Testing 
-- Run the code below


DROP TABLE IF EXISTS bugs;


CREATE TABLE `bugs` (
  `id` int(11) NOT NULL DEFAULT '0',
  `open_date` date DEFAULT NULL,
  `close_date` date DEFAULT NULL,
  `severity` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM ;

--
-- Dumping data for table `bugs`
--

INSERT INTO `bugs` VALUES
(79090, '2016-01-08', '2016-02-11', 1),
(79093, '2016-01-08', '2016-01-29', 1),
(79095, '2016-01-08', '2016-02-02', 1),
(79236, '2016-01-13', '2016-01-27', 1),
(79234, '2016-01-14', NULL, 1),
(79242, '2016-01-15', '2016-01-27', 1),
(79248, '2016-01-15', '2016-02-02', 1),
(79229, '2016-01-15', '2016-02-11', 1),
(79228, '2016-01-15', '2016-02-15', 1),
(79245, '2016-01-15', '2016-03-18', 1),
(79360, '2016-01-18', '2016-01-27', 1),
(79361, '2016-01-19', '2016-02-22', 1),
(79354, '2016-01-19', '2016-02-16', 1),
(79353, '2016-01-19', '2016-03-11', 1),
(79432, '2016-01-21', '2016-01-27', 1),
(79435, '2016-01-21', '2016-01-28', 1),
(79466, '2016-01-22', '2016-02-04', 1),
(79439, '2016-01-22', '2016-02-16', 1),
(79476, '2016-01-22', '2016-02-02', 1),
(79511, '2016-01-22', '2016-02-05', 1),
(79579, '2016-01-25', '2016-02-15', 1),
(79577, '2016-01-25', '2016-02-15', 1),
(79736, '2016-01-25', '2016-02-11', 1),
(79581, '2016-01-25', '2016-02-15', 1),
(79583, '2016-01-25', '2016-02-15', 1),
(79607, '2016-01-25', '2016-01-29', 1),
(79608, '2016-01-25', '2016-01-29', 1),
(79609, '2016-01-25', '2016-03-31', 1),
(79575, '2016-01-25', '2016-02-15', 1),
(79573, '2016-01-25', '2016-02-15', 1),
(79518, '2016-01-25', '2016-01-29', 1),
(79532, '2016-01-25', '2016-02-25', 1),
(79535, '2016-01-25', NULL, 1),
(79541, '2016-01-25', NULL, 1),
(79567, '2016-01-25', '2016-02-15', 1),
(79569, '2016-01-25', '2016-02-15', 1),
(79571, '2016-01-25', '2016-02-15', 1),
(79710, '2016-01-26', '2016-02-19', 1),
(79712, '2016-01-26', '2016-02-19', 1),
(79714, '2016-01-26', '2016-03-01', 1),
(79716, '2016-01-26', '2016-02-29', 1),
(79717, '2016-01-26', '2016-03-02', 1),
(79718, '2016-01-26', '2016-02-18', 1),
(79719, '2016-01-26', '2016-03-03', 1),
(79721, '2016-01-26', '2016-03-16', 1),
(79735, '2016-01-26', '2016-02-03', 1),
(79757, '2016-01-26', '2016-04-04', 1),
(79708, '2016-01-26', '2016-02-19', 1),
(79706, '2016-01-26', '2016-02-29', 1),
(79692, '2016-01-26', '2016-02-18', 1),
(79618, '2016-01-26', '2016-02-02', 1),
(79622, '2016-01-26', '2016-02-02', 1),
(79658, '2016-01-26', '2016-02-11', 1),
(79690, '2016-01-26', '2016-02-18', 1),
(79621, '2016-01-26', '2016-01-29', 1),
(79702, '2016-01-26', '2016-02-19', 1),
(79698, '2016-01-26', '2016-02-18', 1),
(79696, '2016-01-26', '2016-02-18', 1),
(79694, '2016-01-26', '2016-02-19', 1),
(79726, '2016-01-27', '2016-02-15', 1),
(79748, '2016-01-27', '2016-02-23', 1),
(79822, '2016-01-28', '2016-02-17', 1),
(79832, '2016-01-28', NULL, 1),
(79897, '2016-01-29', '2016-02-19', 1),
(79898, '2016-01-29', '2016-02-26', 1),
(79899, '2016-01-29', '2016-02-26', 1),
(79900, '2016-01-29', '2016-02-19', 1),
(79882, '2016-01-29', '2016-02-26', 1),
(79877, '2016-01-29', NULL, 1),
(79875, '2016-01-29', '2016-02-12', 1),
(79842, '2016-01-29', '2016-02-17', 1),
(79841, '2016-01-29', NULL, 1),
(79973, '2016-02-01', '2016-02-16', 1),
(79972, '2016-02-01', '2016-02-22', 1),
(79970, '2016-02-01', '2016-02-12', 1),
(79936, '2016-02-01', '2016-02-25', 1),
(79932, '2016-02-01', '2016-02-15', 1),
(79929, '2016-02-01', '2016-02-15', 1),
(79927, '2016-02-01', '2016-02-15', 1),
(79910, '2016-02-01', '2016-02-16', 1),
(79905, '2016-02-01', NULL, 1),
(79974, '2016-02-02', '2016-02-11', 1),
(79964, '2016-02-02', '2016-02-25', 1),
(80051, '2016-02-03', '2016-03-14', 1),
(80050, '2016-02-03', '2016-03-14', 1),
(80049, '2016-02-03', '2016-02-10', 1),
(80046, '2016-02-03', '2016-03-03', 1),
(80040, '2016-02-03', '2016-03-08', 1),
(80038, '2016-02-03', '2016-03-02', 1),
(80036, '2016-02-03', '2016-03-03', 1),
(80034, '2016-02-03', '2016-02-19', 1),
(80032, '2016-02-03', '2016-03-02', 1),
(79983, '2016-02-03', NULL, 1),
(79979, '2016-02-03', '2016-04-06', 1),
(79981, '2016-02-03', '2016-03-02', 1),
(80130, '2016-02-04', '2016-02-15', 1),
(80107, '2016-02-04', '2016-02-15', 1),
(80105, '2016-02-04', '2016-02-15', 1),
(80103, '2016-02-04', '2016-02-15', 1),
(80101, '2016-02-04', '2016-02-15', 1),
(80064, '2016-02-04', '2016-03-28', 1),
(80062, '2016-02-04', NULL, 1),
(80061, '2016-02-04', '2016-02-24', 1),
(80161, '2016-02-05', '2016-02-16', 1),
(80162, '2016-02-05', NULL, 1),
(80163, '2016-02-05', '2016-02-22', 1),
(80165, '2016-02-05', '2016-02-22', 1),
(80166, '2016-02-05', NULL, 1),
(80167, '2016-02-05', '2016-02-16', 1),
(80168, '2016-02-05', '2016-03-07', 1),
(80169, '2016-02-05', '2016-03-03', 1),
(80171, '2016-02-05', '2016-03-03', 1),
(80175, '2016-02-05', '2016-02-26', 1),
(80140, '2016-02-05', '2016-02-16', 1),
(80146, '2016-02-05', '2016-03-08', 1),
(80147, '2016-02-05', '2016-03-01', 1),
(80150, '2016-02-05', '2016-02-19', 1),
(80170, '2016-02-05', '2016-02-22', 1),
(80204, '2016-02-11', '2016-02-26', 1),
(80206, '2016-02-11', '2016-02-26', 1),
(80207, '2016-02-11', '2016-02-22', 1),
(80203, '2016-02-11', '2016-04-11', 1),
(80208, '2016-02-11', '2016-03-04', 1);


SET @start_date := '2016-01-08';
SET @end_date := '2016-02-11';


SELECT id, @day := DATE_ADD(@day, INTERVAL 1 DAY) AS 'Day', 
	(SELECT COUNT(*) 
	FROM bugs
	WHERE  STR_TO_DATE(open_date, '%Y-%m-%d')  <= STR_TO_DATE(@day, '%Y-%m-%d') 
		AND ( STR_TO_DATE(close_date, '%Y-%m-%d') >= STR_TO_DATE(@day, '%Y-%m-%d') or close_date IS NULL )) AS 'Open Bugs'
FROM  bugs b, (SELECT @day := DATE_SUB(STR_TO_DATE(@start_date, '%Y-%m-%d'),INTERVAL 1 DAY)   ) d
WHERE STR_TO_DATE(@day, '%Y-%m-%d') < STR_TO_DATE(@end_date, '%Y-%m-%d');

-- Expected result:
/*
id	hoje	bugs open
79090	2016-01-08	3
79093	2016-01-09	3
79095	2016-01-10	3
79228	2016-01-11	3
79229	2016-01-12	3
79234	2016-01-13	4
79236	2016-01-14	5
79242	2016-01-15	10
79245	2016-01-16	10
79248	2016-01-17	10
79353	2016-01-18	11
79354	2016-01-19	14
79360	2016-01-20	14
79361	2016-01-21	16
79432	2016-01-22	20
79435	2016-01-23	20
79439	2016-01-24	20
79466	2016-01-25	37
79476	2016-01-26	59
79511	2016-01-27	61
79518	2016-01-28	59
79532	2016-01-29	67
79535	2016-01-30	62
79541	2016-01-31	62
79567	2016-02-01	71
79569	2016-02-02	73
79571	2016-02-03	80
79573	2016-02-04	87
79575	2016-02-05	101
79577	2016-02-06	100
79579	2016-02-07	100
79581	2016-02-08	100
79583	2016-02-09	100
79607	2016-02-10	100
79608	2016-02-11	104
*/